<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>私的酒場探訪記</title>
<script src="js/jquery-2.1.3.min.js"></script>
<script src="js/jquery.barrating.min.js"></script>
<link rel="stylesheet" href="css/sample.css">
<link href="http://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" rel="stylesheet">
<link rel="stylesheet" href="css/fontawesome-stars.css">
</head>
<body>
<header>
<h1>私的酒場探訪記</h1>
</header>
<main>
    <h2>※訪れた酒場の店名や評価などを入力してください</h2>
    <dl id="form">
        <dt>店名</dt>
        <dd><input type="text" id="key"></dd>
        <dt>さけ評価</dt>
        <dd><select name="drink" id="sele_d">
            <option value="★">★</option>
            <option value="★★">★★</option>
            <option value="★★★">★★★</option>
            <option value="★★★★">★★★★</option>
            <option value="★★★★★">★★★★★</option>
        </select></dd>
        <dt>めし評価</dt>
        <dd><select name="food" id="sele_f">
            <option value="★">★</option>
            <option value="★★">★★</option>
            <option value="★★★">★★★</option>
            <option value="★★★★">★★★★</option>
            <option value="★★★★★">★★★★★</option>
        </select></dd>
        <dt>安さ評価</dt>
        <dd><select name="cospa" id="sele_c">
            <option value="★">★</option>
            <option value="★★">★★</option>
            <option value="★★★">★★★</option>
            <option value="★★★★">★★★★</option>
            <option value="★★★★★">★★★★★</option>
        </select></dd>
        <dt>一口メモ</dt>
        <dd><textarea id="memo"></textarea></dd>
    </dl>
    <ul class="option">
        <li id="save">登録・更新</li>
        <li id="cancel">入力取消</li>
        <li id="remove">１件消去</li>
    </ul>
</main>
<h2>※店名をクリックすると評価内容が上記入力フォームに引用されます</h2>
<table id="list">
    <tr>
        <th class="title">店名</th>
        <th class="tl_d">さけ</th>
        <th class="tl_f">めし</th>
        <th class="tl_c">安さ</th>
        <th class="content">一口メモ</th>
        <th class="date">登録・更新日</th>
    </tr>
<!-- ここに追加データが挿入される -->
</table>
<div id="clear">全件消去</div>

<script>

// 星評価実装
// $(function() {
//   $('#sele_d').barrating({
//     theme: 'fontawesome-stars'
//   });
// });
// $(function() {
//   $('#sele_f').barrating({
//     theme: 'fontawesome-stars'
//   });
// });
// $(function() {
//   $('#sele_c').barrating({
//     theme: 'fontawesome-stars'
//   });
// });

// Save クリックイベント
$("#save").on('click',function(){
    const lookfor_key = $('#key').val();
    if(lookfor_key == ''){
        alert('店名を入力してください');
    }else{
        if(!(localStorage.getItem(lookfor_key) == null)){
            const result = confirm('この店名はすでに登録されています。情報を更新しますか？')
            if(result){
                const key = $('#key').val();
                const ev_d = $("#sele_d").val();
                const ev_f = $("#sele_f").val();
                const ev_c = $("#sele_c").val();
                const memo = $('#memo').val();
                const now = new Date();
                const y = now.getFullYear();
                const m = now.getMonth()+1;
                const d = now.getDate();
                const w = now.getDay();
                const wd = ['日','月','火','水','木','金','土'];
                const h = now.getHours();
                const mi = now.getMinutes();
                const s = now.getSeconds();
                const now_date = y+'/'+m+'/'+d+'('+wd[w]+')'+h+':'+mi+':'+s;
                const ori_data ={
                    ev_d:ev_d,
                    ev_f:ev_f,
                    ev_c:ev_c,
                    content:memo,
                    date:now_date
                };
                const jsondata = JSON.stringify(ori_data);
                localStorage.setItem(key,jsondata);
                location.reload();
            };
        }else{        
            const key = $('#key').val();
            const ev_d = $("#sele_d").val();
            const ev_f = $("#sele_f").val();
            const ev_c = $("#sele_c").val();
            const memo = $('#memo').val();
            const now = new Date();
            const y = now.getFullYear();
            const m = now.getMonth()+1;
            const d = now.getDate();
            const w = now.getDay();
            const wd = ['日','月','火','水','木','金','土'];
            const h = now.getHours();
            const mi = now.getMinutes();
            const s = now.getSeconds();
            const now_date = y+'/'+m+'/'+d+'('+wd[w]+')'+h+':'+mi+':'+s;
            const ori_data ={
                ev_d:ev_d,
                ev_f:ev_f,
                ev_c:ev_c,
                content:memo,
                date:now_date
            };
            const jsondata = JSON.stringify(ori_data);
            localStorage.setItem(key,jsondata);
            location.reload();
        };
    }
})

// Cancelクリックイベント
$("#cancel").on('click',function(){
    $("#key").val('');
    $("#sele_d").val('★');
    $("#sele_f").val('★');
    $("#sele_c").val('★');
    $("#memo").val('');
})

// remove クリックイベント
$("#remove").on('click',function(){
    const lookfor_key = $('#key').val();
    if(localStorage.getItem(lookfor_key) == null){
        alert('削除する情報がありません');
    }else{
        const result = confirm("選択した店の記録を消去してもよろしいですか？");
        if(result){
            const key = $('#key').val();
            localStorage.removeItem(key);
            location.reload();
        }
    }
})

// clear クリックイベント
$("#clear").on('click',function(){
    const keycount = localStorage.length;
    if(keycount == 0){
        alert('削除する情報がありません');
    }else{
        const result = confirm("本当に全件消去してもよろしいですか？");
        if(result){
            const result = confirm("あなたが渡り歩いてきた数々の酒場の想い出を本当に消してしまうんですか？");
            if(result){
                const result = confirm("いまならまだ引き返せますよ？");
                if(result){
                    const result = confirm("お酒と縁を切る覚悟があるんですか？");
                    if(result){
                        alert("さよなら！べ、べつに寂しくなんてないんだからっ！")
                        localStorage.clear();
                        location.reload();
                    }
                    
                }
            }
        }
    }
    

})

// ページ読み込み：保存データ取得表示
for(let i=0; i<localStorage.length; i++){
    const key = localStorage.key(i);
    const memo = localStorage.getItem(key);
    const reco_data = JSON.parse(memo);
    const ev_d = reco_data.ev_d;
    const ev_f = reco_data.ev_f;
    const ev_c = reco_data.ev_c;
    const content = reco_data.content;
    const date = reco_data.date;
    const html = '<tr><td class="list_title">'+key+'</td><td class="ev_d">'+ev_d+'</td><td>'+ev_f+'</td><td>'+ev_c+'</td><td>'+content+'</td><td>'+date+'</td></tr>';
    // if(ev_d==1){
    //     $(".ev_d").html('★');
    // }else if(ev_d==2){
    //     $(".ev_d").html('★★');
    // }else if(ev_d==3){
    //     $(".ev_d").html('★★★');
    // }else if(ev_d==4){
    //     $(".ev_d").html('★★★★');
    // }else if(ev_d==5){
    //     $(".ev_d").html('★★★★★');
    // }    
    $("#list").append(html);
}

// 評価内容を入力フォームに引用
$(".list_title").on('click',function(){
    const key = $(this).text();
    const memo = localStorage.getItem(key);
    const data = JSON.parse(memo);
    const ev_d = data.ev_d;
    const ev_f = data.ev_f;
    const ev_c = data.ev_c;
    const content = data.content    
    $("#key").val(key);
    $("#sele_d").val(ev_d);
    $("#sele_f").val(ev_f);
    $("#sele_c").val(ev_c);
    $("#memo").val(content);
})

</script>
<footer><small>G's</small></footer>
</body>
</html>
